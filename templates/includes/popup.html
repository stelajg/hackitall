<!-- includes/popup.html -->
<div id="welcomePopup" class="popup-box" style="display: none;">
    <div class="popup-inner">
        <span class="close-btn" id="closePopup">&times;</span>
        <h5>ðŸ‘‹ Welcome to NTB!</h5>
        <p>We're happy you're here. If you need help or want to tell us who you are, you can do it below:</p>

        <!-- ðŸ‘‡ Chatbot Section -->
        <div id="chatbot" style="margin-top: 20px; border-top: 1px solid #ddd; padding-top: 10px;">
            <h6>ðŸ’¬ Chat with NTB Assistant</h6>
            <div id="chatWindow" style="height: 150px; overflow-y: auto; background: #f9f9f9; padding: 10px; border: 1px solid #ccc; margin-bottom: 10px;">
            <!-- Chat messages will go here -->
            </div>
            <div style="display: flex; gap: 5px;">
            <input type="text" id="userMessage" placeholder="Type your message..." class="form-control" />
            <button id="sendMessage" class="btn-secondary">Send</button>
            </div>
            <script>
              document.getElementById("sendMessage").addEventListener("click", async () => {
                const chatWindow = document.getElementById("chatWindow");
                const input = document.getElementById("userMessage");
                const message = input.value.trim();
            
                if (message) {
                  // User message
                  chatWindow.innerHTML += `<div><strong>You:</strong> ${message}</div>`;
            
                  // Basic fake bot response with async function
                  setTimeout(async () => {
                    const botReply = await generateBotReply(message);
                    chatWindow.innerHTML += `<div><strong>NTB Bot:</strong> ${botReply}</div>`;
                    chatWindow.scrollTop = chatWindow.scrollHeight;
                  }, 500);
            
                  input.value = '';
                }
              });
            
              async function generateBotReply(msg) {
                const url = 'http://127.0.0.1:5005/chat';
            
                // Construct the data to be sent in the request
                const data = {
                  message: msg // The message from the user
                };
            
                try {
                  // Use fetch to make the POST request and wait for the response
                  const response = await fetch(url, {
                    method: 'POST',
                    headers: {
                      'Content-Type': 'application/json' // Set the Content-Type header to JSON
                    },
                    body: JSON.stringify(data) // Convert the data to a JSON string
                  });
                  // Parse the response as JSON
                  const responseData = await response.json();
            
                  console.log('Bot reply:', responseData.response); // Handle the bot's reply
                  return responseData.response; // Return the bot's reply
                } catch (error) {
                  console.error('Error:', error); // Handle any errors
                  return "Sorry, I couldn't process your request."; // Fallback reply in case of error
                }
              }
            </script>
            
        </div>
    </div>
</div>
  